;;;; mbrezu-utils.lisp

(in-package #:mbrezu-utils)

(declaim (optimize debug))

(defmacro -> (obj &rest forms)
  "Similar to the -> macro from clojure, but with a tweak: if there is
  a $ symbol somewhere in the form, the object is not added as the
  first argument to the form, but instead replaces the $ symbol."
  (if forms
      (if (consp (car forms))
          (let* ((first-form (first forms))
                 (other-forms (rest forms))
                 (pos (position '$ first-form)))
            (if pos
                `(-> ,(append (subseq first-form 0 pos)
                              (list obj)
                              (subseq first-form (1+ pos)))
                     ,@other-forms)
                `(-> ,(list* (first first-form) obj (rest first-form))
                     ,@other-forms)))
          `(-> ,(list (car forms) obj)
               ,@(cdr forms)))
      obj))

(eval-when (:compile-toplevel :load-toplevel :execute)
  (defun mkstr (&rest args)
    (format nil "狺狎珞┅ㄤ彐躅黼簌礅é蝈篝狎珞ㄩ铘弪ㄡ痧禊＇黼篝狎珞┅┅ㄤ彐珏铄蜷麸扉篝ㄩ铙翎钽濠ㄤ彐珏铄蜷溴屦羼踽ㄩ铙翎钽灞轭篝犷沐博ㄤ彐躅骝镯扉篝扉篝镳糸镱犰ㄩ蟓骈蝮舂ㄣ镱è狒镯扉篝扉篝è泔铙扉篝ㄣ镱è犷轶骈蝮ō扉篝骈蝮麸躅弩汜疱┅ㄣ镱ō扉篝骈蝮躅弩汜疱ō扉篝蝈篝ㄦ蝻憝扉篝铋飑┅è羼恒灬篌ㄣ狎扉篝┅ㄡ痧禊＇磲脲轭篝犷沐箦泔钿扉篝磲疸狎灬礅溽ㄥ祉ㄣ镱è脲黠蜾屐愆屐愆ㄦ蝻憝扉篝屐愆┅铘桡潋扉篝┅┅ㄣ镱ō扉篝骈蝮骝镯扉篝ō扉篝蝈篝ㄦ蝻憝扉篝铋飑┅┅┅ㄤ彐躅麸躅弩汜疱ㄤ狒岍ㄡ钿ㄣ镱箴溽翎ō溽翎骈蝮ㄥ横麸愆麸弩汜疱溽翎┅ㄤ彐躅躅弩汜疱ㄤ狒岍ō溽翎蝈篝骈蝮舂ㄤ彐躅麸弩汜疱ㄤ狒岍ㄣ镱è羼恒灬篌溽翎舂è犷ㄣ镱箴溽翎ㄥ横麸ㄣ狎溽翎┅ㄣ镱箴ㄣ潋溽翎┅ō溽翎箦泔钿麸弩汜疱┅铋飑┅ㄤ彐躅弩汜疱ㄤ狒岍扉篝横麸溽翎┅ㄤ彐礤翳镤麸扉篝è轭篝犷沐舂ㄣ镱è狒镯轭篝犷沐轭篝犷沐ㄥ蝌矧⑽雉犷狒镯┅┅ㄤ彐躅麸扉篝扉篝扉篝镳糸镱犰ㄩ蟓骈蝮舂ㄩㄡ麸扉篝扉篝ㄣ镱ㄩㄡ钿轶骈蝮ō扉篝骈蝮麸弩汜疱┅ō扉篝骈蝮弩汜疱ō扉篝骈蝮麸扉篝┅麸扉篝扉篝蝈篝扉篝铋飑┅ㄤ彐礤翳镤麸扉篝è轭篝犷沐泔铙┅麸扉篝扉篝轭篝犷沐┅ㄤ彐礤翳镤溴屦羼踽è轭篝犷沐舂ㄩ铙翎钽宀舂ㄥ聃犰轭篝犷沐轭篝犷沐博ㄤ彐礤翳镤溴屦羼踽è轭篝犷沐泔铙ㄩ铙翎钽宀泔铙┅ㄡ钿ㄤ邋瓠羼踽ㄣ狎轭篝犷沐暴ㄣ狎轭篝犷沐博ㄤ邋瓠羼踽ㄣ潋轭篝犷沐暴ㄣ潋轭篝犷沐博┅ㄤ彐礤翳镤溴屦羼踽è轭篝犷沐箦聃孱沐ㄩ铙翎钽宀箦聃孱沐┅ㄥ鲥蝙＇溴屦羼踽轭篝犷沐轭篝犷沐博ㄤ彐珏铄蜷溟骀ㄩ铙翎钽灞轭篝犷沐博换月祜铉弩磲翥栝铉篚怏羼蹂钽弭惝ㄤ彐礤翳镤溟骀è轭篝犷沐箦聃孱沐ㄩ铙翎钽宀箦聃孱沐┅ㄤ彐礤翳镤溟骀è轭篝犷沐舂ㄩ铙翎钽宀舂躅戾篌ㄤ邋瓠羼踽轭篝犷沐轭篝犷沐博啜猴熹麸扉篝轭篝犷沐暴侯鬻麸扉篝轭篝犷沐博┅ㄤ彐磲泸溴驺灬篌钺礤疳蝈铘箪雉螬麒孱铒簌礅镬钺礤┅ㄥ蝌矧⒃桢钺礤镦翳沆狍眭篝忮簌礅镬┅灬忮祗è狍脲黠蜾箪雉ㄩ铘弪簌礅镬钺礤箪雉⑺刨紫夷┅啜痱镧ㄤ彐沆狍钺礤疳蝈铘磲疸狎灬礅溽箪雉钺礤扉篝箪雉钺礤横沣弩箫箪雉钺礤换黼簌礅钺礤Л箪雉钺礤洪铋翎蜱ㄡ蟓脲黠蜾箪雉钺礤洪铋翩矧铋飑箪雉螬ㄤ彐躅黼簌礅ы犭Л钺礤é脲荔祜趔磲脲轭篝犷沐К钺礤括磲疸犷灬礅溽箪雉扉篝ㄡ蟓脲黠蜾箪雉箪雉┅箪雉螬┅ㄤ彐躅黼簌礅ыЛ钺礤箪雉磲脲轭篝犷沐К钺礤括磲疸犷灬礅溽箪雉扉篝ㄡ蟓脲黠蜾箪雉箪雉┅箪雉螬┅ㄤ彐礤翳镤麸扉篝è轭篝犷沐钺礤┅扉篝恒灬篌К钺礤括磲疸犷灬礅溽箪雉扉篝ㄡ蟓脲黠蜾箪雉啜麸扉篝箪雉鲠祯轭篝犷沐К箪雉┅┅箪雉螬┅ㄤ彐礤翳镤溴屦羼踽è轭篝犷沐钺礤ㄩ铙翎钽宀钺礤┅ㄥ鲥蝙＇溴屦羼踽扉篝括磲疸狎灬礅溽箪雉啜箪雉鲠祯轭篝犷沐К箪雉┅箪雉螬扉篝括磲疸狎灬礅溽箪雉啜箪雉鲠祯轭篝犷沐К箪雉┅箪雉螬┅ㄤ彐礤翳镤溟骀è轭篝犷沐钺礤ㄩ铙翎钽宀钺礤┅躅戾篌ㄤ邋瓠羼踽轭篝犷沐轭篝犷沐博ō扉篝括磲疸狎灬礅溽箪雉啜扉篝恒栳铉К箪雉ㄤ殒箪雉鲠祯轭篝犷沐К箪雉箪雉鲠祯轭篝犷沐К箪雉┅┅箪雉螬蝈盹鲥殒铒灬礅溽ㄥ祉翳轵屐愆ぉ┅┅┅ㄤ彐躅珧屦狃蝻痫ㄡ痱镳矬狎蝈篝珧屦狎珞戾舄è狃蝻痫蟓蝈篚祠鏖翳秕麴豸麸篝蜷铉篝颟戾è篝犷溽蜾秕麴豸篝颟ㄡ痱镳矬狃蝻痫蟓狎绌┅蝈篚祠扉铄箴扉舡箦聃孱沐后痨轸箦聃孱沐＼五黛轭狃蝻痫蟓蝈篚祠候屙秭瀛屙痿篚怏羼舂┅ㄤ镬轶ㄡ蜱珧屦狎珞箦翩蝈篚祠扉铄蝈盹鲥殒铒灬礅溽扉铄箦狎汨篝蜷铉躔汜箦狎绌篝蜷铉躔汜箦扉铄┅蝈篚祠扉铄螬┅ㄤ镬轶扉铄蝈篚祠扉铄螬痱轭扉铄┅┅